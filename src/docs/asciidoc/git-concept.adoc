= Git概念理解
贾明宇 <64896863@qq.com>
2018-08-17
:toc:
ifndef::imagesdir[:imagesdir: images]
ifndef::sourcedir[:sourcedir: ../../main/java]


== 阅读前提

阅读并能理解本文的前提：您是一名软件开发人员，之前有使用其他版本管理工具（比如svn）开发软件的经验。

== 是否应该学习Git

很多人有疑问，“我觉得svn已经足够好了，是否有学习git的必要？” +
我的经验是，如果您不是软件开发人员，并且想使用文件版本管理工具，svn已经足够用了。 +
对于软件开发人员来说，git比svn最大的优势在于代码分支管理。

== 学习之前的概念理解

=== 去中心化与中心化管理

git为去中心化，svn为中心化。大家都习惯了中心化，是因为我们生活中大多数的事物都是中心化的。


[.thumb]
image::centvsdecent.png[Sunset,300,200]

.去中心化与中心化的例子
|===
|中心化 |去中心化

|svn
|git

|网站文件下载
|bt下载

|银行，央行
|加密货币

|警察局
|私家侦探，或者私自解决
|===

去中心化和中心化并不是谁比谁好的概念，而是各有优缺点，中心化效率高，但容易产生极权并滋生腐败，而去中心化更加公平自由，更容易产生创新，却很低效。 +
本文并不介绍git的去中心化概念，主要原因 1 去中心化概念理解复杂. 2 大多数时候我们使用git是在一个中心化环境中，比如公司中，最终代码是要提交到公司的代码库中，你私自保存并修改公司的代码是不合法的。

=== 对软件分支的理解

==== 狭义的分支
最开始开发软件的时候，大家都很朴实，就是一块码代码呗，所以就没什么限制，改完代码就提交，这种模式在人少的时候还好，人一多的时候就出问题了，因为人多，产生错误的概率就越大， 我之前的一个公司，大约50人共同使用一个库，每天开发之前都不敢更新代码库，因为十有八九连最基本的编译都不过😂，更别提测试了。 +

这时候有人就想，能不能弄一套稳定的代码，然后我的任务以这个稳定的代码为基础开发，等我开发完，测试完之后，再合入这个稳定版本不就好了嘛。因此这个时候分支的概念就出来了，分支实际上是对软件的一种管理，它将代码的功能，稳定性隔离起来，更加方便。

==== 广义的分支
ps. 本节为选读。 +
分支在软件行业，尤其是开源软件中非常流行。但是它在各行各业都有。 +
牛顿曾经说过：如果说我看得比别人更远些，那是因为我站在巨人的肩膀上。这是因为，在人类历史中，任何行业的创新，都是基于原有的事物之上的，都是在合法“抄袭”，“山寨”别人的东西，取其精华，去其糟粕，才能创造出更好的东西。腾讯一直背负着抄袭的坏名声，我们不去讨论这些争议，但是最终人们选择了腾讯的产品，是因为腾讯能够“借鉴”别人的产品，并做得更好。我们今天使用的微软和苹果操作系统的界面，最早都是“借鉴”了施乐公司的产品。 +
因此广义的分支，则是借鉴现有的产品线，在其基础上再创作。而开源软件行业，大家提倡鼓励的就是软件的分享，因此分支更容易“借鉴”别人的软件，如果你喜欢别人的软件，直接fork一份自己去改就好了。

=== git比svn“奇怪”的地方
用惯了svn的同学，开始往往用svn的概念去套用git，然而二者相差太大，很多地方没法套用。

- 代码数据库的位置。svn中，你的工作目录中仅仅包括代码的文件，文件的历史记录在服务器的数据库中，你做的大部分操作（例如查看代码历史记录）都需要与服务器通讯。 而git环境中你的工作目录里不仅包括代码的文件，还包括所有文件的全部历史记录数据库，相当于把svn服务器的东西放本地了，你做的大部分操作（例如查看代码历史记录）都在本地完成，不需要与服务器通讯。这样的差别说明： 1. 这是中心化与去中心化的不同，git中你的本地和服务器是平等的，拥有同样的数据。 2. 由于所有的数据库在本地，git的操作相比svn非常快。 3. 由于所有的数据库在本地，git库中不推荐保存大文件（实际上任何版本管理工具都不应该保存大文件），这样会导致本地数据库巨大，并且影响操作性能。

- 分支的形式。我们用惯了电脑的人，往往用文件的形式理解分支，比如，我们svn中理想的分支是这样的：

[.thumb]
image::branchsvn.png[]

我们理所当然的认为，每个分支都是在#不同的#文件夹内，我们心里并没有切换分支的概念，因为不需要切换，想改哪个分支直接在相关的文件夹内修改，然后提交就可以了。 +
然而在git中分支却不是这样的，git中的分支：

[.thumb]
image::branchgit.png[]

这时候很多人就暗想，这不就是一个简单的项目文件夹么？我要的分支在哪里？ +
git中，#当前的工作目录指向的某个分支#，若你想使用其他分支，需要#手工切换#，切换后，当前工作目录里的文件会变成相关分支里的文件。很多同学这里不太理解，我的文件目录，难不成切换分之后会自己变动？是的，你没猜错，#切换分支后，git会根据本地数据库里该分支的数据，将工作目录中的文件替换成为该分支的文件#。

- 接上条，在svn的语境中，有人说：“提交到主干”，“提交到分支”，“从分支合并到主干”，这里主干和分支都指的是#远程服务器#，这几个概念非常简单。而git的语境中，主干和分支在#远程#和#本地#都存在，因此上面三句话的意思里，“提交”一定指的是提交代码到本地主干或分支，而“合并”，则有可能是从“本地分支1合并到本地分支2”，“从本地分支合并到本地主干”，“从本地分支1合并（push）到远程分支1”，异常复杂。大家尤其要思维清晰，清楚的知道你现在工作目录的分支状态，以及远程服务器的分支状态，不管是新开分支，或者是合并的时候，一定要保持代码最新，一定要#从远程服务器更新最新的代码到本地#。

[plantuml]
----
@startuml
rectangle <<本机>> {
    cloud 工作目录 as workdir
	rectangle "本地主干" as lobalmaster
	rectangle "本地分支1" as localbranch1
	rectangle "本地分支2" as localbranch2
    workdir --> localbranch1
    workdir .. lobalmaster
    workdir .. localbranch2
    note right of workdir : 指向本地分支1
}

rectangle <<远程服务器>> {
	rectangle "远程主干"
	rectangle "远程分支1"
	rectangle "远程分支2"
}
@enduml
----